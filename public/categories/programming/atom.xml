<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: programming | georgepowell.info]]></title>
  <link href="http://georgepowell.info/categories/programming/atom.xml" rel="self"/>
  <link href="http://georgepowell.info/"/>
  <updated>2014-09-01T22:28:05+01:00</updated>
  <id>http://georgepowell.info/</id>
  <author>
    <name><![CDATA[George Powell]]></name>
    <email><![CDATA[georgepowell_1@hotmail.co.uk]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Ridiculously succinct array manipulation in javascript]]></title>
    <link href="http://georgepowell.info/writing/lambda-functions-in-vanilla-javascript/"/>
    <updated>2014-08-27T23:04:57+01:00</updated>
    <id>http://georgepowell.info/writing/lambda-functions-in-vanilla-javascript</id>
    <content type="html"><![CDATA[<p>Introducing <a href="/docs/z.js">z.js</a> &ndash; a lightweight javascript library that allows you to use a ridiculously succinct syntax for working with javascript arrays, like <code>[1, 2, 3].map('a * 2').filter('a % 5 == 0');</code>. They&rsquo;re like lambdas in C# but better.</p>

<p>Here&rsquo;s the code in full:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="c1">// z() takes a string-lambda and returns a function representing that lambda</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">z</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">lambda</span><span class="p">)</span> <span class="p">{</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">lambda</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span> <span class="o">||</span> <span class="nx">lambda</span> <span class="k">instanceof</span> <span class="nb">String</span><span class="p">))</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">lambda</span><span class="p">;</span> <span class="c1">// if Z() is passed a function, it is returned unmodified</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">lambda</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; =&amp;gt; &quot;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">inputs</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">code</span><span class="p">;</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>  <span class="k">if</span> <span class="p">(</span><span class="nx">parts</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span><span class="p">{</span>
</span><span class='line'>    <span class="nx">inputs</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">code</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nx">inputs</span> <span class="o">=</span> <span class="s2">&quot;abcdef&quot;</span><span class="p">;</span> <span class="c1">// Implicit parameter names a-f</span>
</span><span class='line'>    <span class="nx">code</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">code</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">code</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">$$</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">expression</span> <span class="o">=</span> <span class="nx">code</span><span class="p">;</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span> <span class="nx">inputs</span><span class="p">.</span><span class="nx">length</span> <span class="o">||</span> <span class="nx">i</span> <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$$</span><span class="p">[</span><span class="nx">inputs</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span><span class='line'>        <span class="nx">expression</span> <span class="o">=</span> <span class="nx">expression</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">inputs</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;$$[&#39;&quot;</span> <span class="o">+</span> <span class="nx">inputs</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39;]&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="nx">expression</span> <span class="o">=</span> <span class="nx">expression</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="nx">inputs</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;($$[&#39;&quot;</span> <span class="o">+</span> <span class="nx">inputs</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39;])&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="nx">expression</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>And to make the standard <code>Array.prototype</code> methods support the new string-lambdas:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">forEachF</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">forEach</span><span class="p">;</span>
</span><span class='line'><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">forEach</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">lambda</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">forEachF</span><span class="p">(</span><span class="nx">z</span><span class="p">(</span><span class="nx">lambda</span><span class="p">));</span> <span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">everyF</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">every</span><span class="p">;</span>
</span><span class='line'><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">every</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">lambda</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">everyF</span><span class="p">(</span><span class="nx">z</span><span class="p">(</span><span class="nx">lambda</span><span class="p">));</span> <span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">someF</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">some</span><span class="p">;</span>
</span><span class='line'><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">some</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">lambda</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">someF</span><span class="p">(</span><span class="nx">z</span><span class="p">(</span><span class="nx">lambda</span><span class="p">));</span> <span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">filterF</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">filter</span><span class="p">;</span>
</span><span class='line'><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">filter</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">lambda</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">filterF</span><span class="p">(</span><span class="nx">z</span><span class="p">(</span><span class="nx">lambda</span><span class="p">));</span> <span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">findF</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">find</span><span class="p">;</span>
</span><span class='line'><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">find</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">lambda</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">findF</span><span class="p">(</span><span class="nx">z</span><span class="p">(</span><span class="nx">lambda</span><span class="p">));</span> <span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">findIndexF</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">findIndex</span><span class="p">;</span>
</span><span class='line'><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">findIndex</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">lambda</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">findIndexF</span><span class="p">(</span><span class="nx">z</span><span class="p">(</span><span class="nx">lambda</span><span class="p">));</span> <span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">keysF</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">keys</span><span class="p">;</span>
</span><span class='line'><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">keys</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">lambda</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">keysF</span><span class="p">(</span><span class="nx">z</span><span class="p">(</span><span class="nx">lambda</span><span class="p">));</span> <span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">mapF</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">map</span><span class="p">;</span>
</span><span class='line'><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">map</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">lambda</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">mapF</span><span class="p">(</span><span class="nx">z</span><span class="p">(</span><span class="nx">lambda</span><span class="p">));</span> <span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">reduceF</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">reduce</span><span class="p">;</span>
</span><span class='line'><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">reduce</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">lambda</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">reduceF</span><span class="p">(</span><span class="nx">z</span><span class="p">(</span><span class="nx">lambda</span><span class="p">));</span> <span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">reduceRightF</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">reduceRight</span><span class="p">;</span>
</span><span class='line'><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">reduceRight</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">lambda</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">reduceRightF</span><span class="p">(</span><span class="nx">z</span><span class="p">(</span><span class="nx">lambda</span><span class="p">));</span> <span class="p">}</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h2>Usage</h2>

<p>This kind of syntax is best used with functional-type programming with methods like <em>map</em> and <em>filter</em>.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="kd">var</span> <span class="nx">numbers</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">];</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="c1">// These 3 lines will all do exactly the same thing:</span>
</span><span class='line'><span class="nx">numbers</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">a</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> <span class="p">});</span> <span class="c1">// plain old javascript</span>
</span><span class='line'><span class="nx">numbers</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">a</span> <span class="o">=&gt;</span> <span class="nx">a</span> <span class="o">*</span> <span class="mi">2</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;);</span> <span class="c1">// explicit variable names</span>
</span><span class='line'><span class="nx">numbers</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">a</span> <span class="o">*</span> <span class="mi">2</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;);</span> <span class="c1">// implicit variable name of &amp;lsquo;a&amp;rsquo;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">numbers</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">a</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;).</span><span class="nx">map</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">a</span> <span class="o">*</span> <span class="mi">2</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;).</span><span class="nx">reduce</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">a</span> <span class="o">+</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;,</span> <span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;</span> <span class="o">+</span> <span class="nx">b</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;);</span> <span class="c1">// Which allows for simple, readable, functional array manipulation.&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h2>Warning!</h2>

<p>This method is sketchy and has been built here as a proof of concept. It&rsquo;s significantly slower than normal javascript anonymous functions and probably has some other serious problems. Enjoy!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Numerical Methods and the Green Brain Project]]></title>
    <link href="http://georgepowell.info/writing/numerical-methods-and-the-green-brain-project/"/>
    <updated>2014-08-10T10:23:02+01:00</updated>
    <id>http://georgepowell.info/writing/numerical-methods-and-the-green-brain-project</id>
    <content type="html"><![CDATA[<p><a href="/writing/i-for-one-welcome-our-new-insect-overlords/">I posted about the Green Brain Project</a> a while ago before starting my placement there. Last week I finished, after spending 6 weeks working with the team investigating ways to improve their numerical simulation methods. For the interested I&rsquo;ll summarise the work I&rsquo;ve done. The full report <a href="/docs/improving-simulation-methods.pdf">can be found here</a>.</p>

<h2>The Spine-Creator tool</h2>

<p>Spine-creator is a tool for building and simulating biological neural networks, built by <a href="http://www.alexcope.co.uk/">Alex Cope</a> of the Green Brain Project. It&rsquo;s designed to be powerful, flexible and usable by non-programmers, with a graphical user interface to visualise and build the networks. &lsquo;Components&rsquo; can be designed and connected together with other components, and the system can be compiled and simulated from within the program. The tool is open source and can be <a href="https://github.com/SpineML/SpineML_2_BRAHMS">found on GitHub here</a>.</p>

<p><img src="/images/spine-creator.png" width="700" alt="Spine-Creator visual interface" /></p>

<p><em>The Spine-Creator visual interface</em></p>

<p>The behaviour of components are usually specified with systems of <a href="http://en.wikipedia.org/wiki/Ordinary_differential_equation">Ordinary Differential Equations (ODEs)</a>: mathematical systems that start at a given state and progress through time acording to the differential equations. For neuron models, there would typically be variables and equations describing how voltages, resistances and chemical concetrations change over time from initial conditions.</p>

<p>Simulating these systems therefore requires <em>solving</em> these sets of equations, which usually isn&rsquo;t possible with the normal algebraic methods taught in school. Instead <a href="http://en.wikipedia.org/wiki/Numerical_methods_for_ordinary_differential_equations">numerical methods</a> are used, these are methods that calculate accurate estimates of how the system will behave, and are usually parameterised to give simulations of any desired accuracy.</p>

<h2>Forward Euler</h2>

<p>Forward Euler is the simplest and most common numerical method for solving ODEs, it is based on the definition of the differential, and can be written in a line or two of code (C#):</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="p">&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;</span><span class="c1">// Takes the value of a variable (initial) along with the rate-of-chage at that point (differential),</span>
</span><span class='line'><span class="c1">// returns an estimate of the value of the variable after a time-period (dt).</span>
</span><span class='line'><span class="kt">double</span> <span class="nf">forwardEuler</span><span class="p">(</span><span class="kt">double</span> <span class="n">initial</span><span class="p">,</span> <span class="kt">double</span> <span class="n">differential</span><span class="p">,</span> <span class="kt">double</span> <span class="n">dt</span><span class="p">)</span> <span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="k">return</span> <span class="n">initial</span> <span class="p">+</span> <span class="n">dt</span> <span class="p">*</span> <span class="n">differential</span><span class="p">;</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>You can see that the amount the initial value changes by is proportional to the rate it is changing <em>(differential)</em> and the length of time it is changing for <em>(dt)</em>. This method works, and can achieve any desirable accuracy if iterated over and over again with tiny values for <em>dt</em>. But has a number of <a href="http://en.wikipedia.org/wiki/Numerical_stability">stability problems</a> when simulating particular systems. For example if Forward Euler is used to solve a Sine-Cosine system&hellip;</p>

<p><img src="/images/forward-euler.png" width="500" alt="Sin-Cosine System" /></p>

<p>The result wildly and exponentially oscilates rather than stably moving between +/&ndash; 1.0. The Spine-Creator tool used the Forward Euler method, and this problem (along with others) was the motivation for the research project.</p>

<h2>Runge Kutta methods</h2>

<p>The main class of methods we investigated are called <a href="http://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods">Runge-Kutta methods</a>. They work by calculating the differential at multiple points between the intitial time and <em>dt</em>, and calculating an estimate of the state at the <em>end</em> of the time-step using a linear combination of those differentials. There are a number of algorithms in this class, the most popular being <strong>modified Euler</strong> and <strong>Runge-Kutta 4th Order</strong>. These methods provide more accurate, efficient and stable solutions and can be used with much larger values for <em>dt</em>.</p>

<h2>Adaptive time-step methods</h2>

<p>The methods described so far assume a value for <em>dt</em> has already been chosen. Adaptive time-step methods work by providing an estimate for the <em>error</em> introduced during a time period, and using that error estimate to suggest a new value for <em>dt</em> based on a given <em>error-tolerance</em>. These methods can, for example, use a very small <em>dt</em> during chaotic and difficult time-periods, and shift later to using a much larger <em>dt</em> when the system stabilises. The adaptive time-step method I investigated and implemented is called the <a href="http://en.wikipedia.org/wiki/Dormand%E2%80%93Prince_method">Dormand-Prince Method</a>. It can result in very efficient and very accurate solutions compared to similar fixed-time-step methods. Run on a single variable system (see the full report and code for details) the result clearly shows a changing time-step:</p>

<p><img src="/images/adaptive-step.png" width="500" alt="Sin-Cosine System" /></p>

<p>Visually, the dots get further apart as the system progresses and becomes more linear.</p>

<h2>Parallelisation and Synaptic Delays</h2>

<p>Part of the project&rsquo;s aims are to simulate the systems in paralell on GPUs. The bottleneck to doing this as it stands is to do with the large degree of connectivity within the network; sharing data between otherwise unconnected sub-systems prohibits simulating them in isolation, as their behaviour will always depend on other neurons from another part of the network. <a href="http://material.brainworks.uni-freiburg.de/publications-brainworks/2007/journal%20papers/Morrison-neco-07_47.pdf">We found a paper</a> that describes a method for isolating subsystems for a maximum period of time, which restricts data-flow between components based on the <em>synaptic delays</em> in the network. Using this method could potentially aid the paralellisation of the simulation.</p>

<h2>Awesome!</h2>

<p>So overall it was a super cool project and I learnt a lot. It&rsquo;s great to get back into mathsy-programming with an enthusiastic acedemic team. A big shoutout to the <a href="http://greenbrain.group.shef.ac.uk/">Green Brain Project</a> and the <a href="http://www.shef.ac.uk/sure">SURE scheme</a> for enabling this project and others for other students, I&rsquo;m looking forward to working with the team again in my 3rd year at the University.</p>

<h2>Code and full report</h2>

<ul>
<li><p>The methods mentioned were implemented in an isolated C++ program <a href="https://github.com/georgepowell/numerical-methods">available on GitHub</a>.</p></li>
<li><p>The full report which was handed in at the end of the placement <a href="/docs/improving-simulation-methods.pdf">is available here (pdf)</a>. This includes tons of details and extras that aren&rsquo;t mentioned in this blog post.</p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Chrome extension #1: Subnito]]></title>
    <link href="http://georgepowell.info/writing/incogno/"/>
    <updated>2014-03-13T13:48:59+00:00</updated>
    <id>http://georgepowell.info/writing/incogno</id>
    <content type="html"><![CDATA[<p>I decided to create a chrome extension last week, it was surprisingly simple. Chrome extensions basically give you a very simple way to inject your own javascript into whatever webpages you like, plus have access to chrome&rsquo;s own APIs for playing with tabs or storing data etc. The whole extension uses nothing but javascript (you can add jquery etc. if you like), and HTML. Even the .manifest file is JSON.</p>

<p>Subnito was my first serious chrome extension. It uses the reddit API to detect if you&rsquo;re browsing an 18+ subreddit on reddit.com and pushes you into incognito mode if so.</p>

<p>The bulk of the work is done in one short file.</p>

<p><strong>background.js</strong>
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="c1">// Trigger this code onBeforeNavigate to any url. This happens even before the web request has been made to increase speed.</span>
</span><span class='line'><span class="nx">chrome</span><span class="p">.</span><span class="nx">webNavigation</span><span class="p">.</span><span class="nx">onBeforeNavigate</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">details</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">details</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">bare_url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;https://&quot;</span><span class="o">&gt;</span><span class="nx">https</span><span class="o">:</span><span class="c1">//&lt;/a&gt;&amp;rdquo;, &amp;ldquo;&amp;rdquo;).replace(&amp;ldquo;&lt;a href=&quot;http://&quot;&gt;http://&lt;/a&gt;&amp;rdquo;, &amp;ldquo;&amp;rdquo;); // remove protocol</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">match_string</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">www</span><span class="p">.</span><span class="nx">reddit</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">r</span><span class="o">/&amp;</span><span class="nx">rdquo</span><span class="p">;;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">bare_url</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">match_string</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">===</span> <span class="nx">match_string</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// check if we&amp;rsquo;re on a reddit subreddit&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span><span class="kd">var</span> <span class="nx">subreddit</span> <span class="o">=</span> <span class="nx">bare_url</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">];</span> <span class="c1">// extract the subreddit name</span>
</span><span class='line'><span class="c1">// request a json document giving the details of the sub using the reddit API</span>
</span><span class='line'><span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="s2">&quot;http://www.reddit.com/r/&quot;</span> <span class="o">+</span> <span class="nx">subreddit</span> <span class="o">+</span> <span class="s2">&quot;/about.json&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;over18&#39;</span><span class="p">])</span> <span class="p">{</span> <span class="c1">// check the boolean over18 flag in the returned json</span>
</span><span class='line'>        <span class="nx">chrome</span><span class="p">.</span><span class="nx">tabs</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">details</span><span class="p">.</span><span class="nx">tabId</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="p">});</span> <span class="c1">// remove non-incognito tab</span>
</span><span class='line'>        <span class="nx">chrome</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">deleteUrl</span><span class="p">({</span> <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="nx">url</span><span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="p">});</span> <span class="c1">// delete url from history completely</span>
</span><span class='line'>        <span class="nx">chrome</span><span class="p">.</span><span class="nx">windows</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span><span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span> <span class="s2">&quot;incognito&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span> <span class="c1">// open incognito window</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>  <span class="p">}</span>
</span><span class='line'><span class="p">})</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><a href="https://github.com/georgepowell/subnito">Full source code on GitHub</a></p>

<p><a href="https://chrome.google.com/webstore/detail/subnito/cdbdngojiagnofammchefeeaacdifikn">Install on Chrome Store</a></p>
]]></content>
  </entry>
  
</feed>
